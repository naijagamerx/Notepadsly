<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Notepadsly</title>
    <link rel="stylesheet" href="../css/style.css"> <!-- General styles -->
    <link rel="stylesheet" href="../css/dashboard.css"> <!-- Dashboard specific styles -->
    <!-- Favicon (to be added later in assets) -->
    <!-- <link rel="icon" href="../assets/favicon.ico" type="image/x-icon"> -->
</head>
<body>
    <div id="globalNotification" class="global-notification"></div>
    <header class="app-header">
        <div class="logo-container">
            <img src="../assets/logo.png" alt="Notepadsly Logo" class="app-logo">
            <h1>Notepadsly</h1>
        </div>
        <nav class="user-nav">
            <div class="offline-toggle-container">
                <label for="workOfflineToggle" title="Save/load current note locally. Does not sync all notes.">Work Offline:</label>
                <input type="checkbox" id="workOfflineToggle" class="toggle-switch">
                <span id="offlineModeIndicator" style="display:none; color: orange; margin-left: 5px;">(Offline)</span>
            </div>
            <span id="usernameDisplay">Welcome, User!</span>
            <span id="adminLinkContainer" style="margin-left: 15px;"></span> <!-- Placeholder for Admin Link -->
            <a href="../php/logout.php" class="button" style="margin-left: 15px;">Logout</a>
        </nav>
    </header>

    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <button id="newNoteBtn" class="button-primary">New Note</button>
            </div>
            <nav class="folder-nav">
                <h3>Folders</h3>
                <ul id="folderList">
                    <!-- Folders will be dynamically populated here -->
                    <li><a href="#" data-folder-id="all">All Notes</a></li>
                    <li><a href="#" data-folder-id="1">Personal</a></li>
                    <li><a href="#" data-folder-id="2">Work</a></li>
                </ul>
                <button id="newFolderBtn">New Folder</button>
            </nav>
            <nav class="tag-nav">
                <h3>Tags <button id="clearTagFiltersBtn" style="display:none; font-size: 0.7em; margin-left: 10px; padding: 2px 5px;">Clear</button></h3>
                <ul id="tagList">
                    <!-- Tags will be dynamically populated here -->
                    <li><a href="#" data-tag-id="important">#important</a></li>
                    <li><a href="#" data-tag-id="ideas">#ideas</a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <div class="note-list-panel">
                <div class="panel-header">
                    <h3>Notes</h3>
                    <input type="search" id="searchNotes" placeholder="Search notes...">
                </div>
                <ul id="noteList">
                    <!-- Notes will be dynamically populated here -->
                    <li class="note-item" data-note-id="1">
                        <h4>Meeting Notes</h4>
                        <p>Discuss project updates...</p>
                        <small>Oct 26, 2023</small>
                    </li>
                    <li class="note-item active" data-note-id="2">
                        <h4>Grocery List</h4>
                        <p>Milk, Eggs, Bread...</p>
                        <small>Oct 25, 2023</small>
                    </li>
                </ul>
            </div>

            <div class="note-editor-panel">
                <div class="panel-header">
                    <input type="text" id="noteTitle" placeholder="Note Title" value="Grocery List">
                    <div class="note-actions">
                        <button id="saveNoteBtn">Save</button>
                        <button id="deleteNoteBtn">Delete</button>
                        <button id="shareNoteBtn">Share</button>
                        <!-- More actions: download, barcode etc. -->
                    </div>
                </div>
                <div class="toolbar">
                    <!-- Formatting buttons: Bold, Italic, List, etc. -->
                    <button>B</button> <button>I</button> <button>U</button>
                </div>
                <textarea id="noteContent" placeholder="Start writing your note here...">Milk, Eggs, Bread, Cheese, Apples.</textarea>
                <div class="note-metadata">
                    <span>Last updated: Oct 25, 2023</span> |
                    <span>Tags: <a href="#">#groceries</a></span>
                </div>
            </div>
        </main>
    </div>

    <footer class="app-footer">
        <p>&copy; <span id="currentYear"></span> Notepadsly. All rights reserved.</p>
        <!-- Mobile navigation icons could go here -->
    </footer>

    <!-- Mobile Footer Menu -->
    <nav class="mobile-footer-menu app-footer"> <!-- Re-using app-footer for now, can be a new class -->
        <button id="mobileNewNoteBtn" class="footer-icon" title="New Note">&#xFF0B;</button> <!-- Plus Icon -->
        <button id="mobileToggleSidebarBtn" class="footer-icon" title="Toggle Folders/Tags">&#128193;</button> <!-- Folder Icon -->
        <button id="mobileSearchBtn" class="footer-icon" title="Search Notes">&#128269;</button> <!-- Magnifying Glass -->
        <button id="mobileUserBtn" class="footer-icon" title="User/Settings">&#128100;</button> <!-- User Icon -->
    </nav>

    <!-- Modal for creating new folder -->
    <div id="newFolderModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-button" data-modal-id="newFolderModal">&times;</span>
            <h4>Create New Folder</h4>
            <input type="text" id="newFolderNameInput" placeholder="Folder Name">
            <button id="confirmNewFolderBtn" class="button-primary">Create</button>
        </div>
    </div>

    <div id="renameFolderModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-button" data-modal-id="renameFolderModal">&times;</span>
            <h4>Rename Folder</h4>
            <input type="text" id="renameFolderNameInput" placeholder="New Folder Name">
            <input type="hidden" id="renameFolderIdInput">
            <button id="confirmRenameFolderBtn" class="button-primary">Rename</button>
        </div>
    </div>

    <!-- Share Note Modal -->
    <div id="shareNoteModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-button" data-modal-id="shareNoteModal">&times;</span>
            <h4>Share Note</h4>
            <form id="shareNoteForm">
                <input type="hidden" id="shareNoteIdInput">
                <div class="form-group">
                    <label for="shareWithUserInput">Share with (Username or Email):</label>
                    <input type="text" id="shareWithUserInput" name="share_with_user" required>
                </div>
                <div class="form-group">
                    <label for="sharePermissionInput">Permission:</label>
                    <select id="sharePermissionInput" name="permission">
                        <option value="read" selected>Read-Only</option>
                        <option value="edit">Edit</option>
                    </select>
                </div>
                <button type="submit" class="button-primary">Add Share / Update New User</button>
            </form>
            <hr>
            <h4>Currently Shared With:</h4>
            <div id="currentlySharedWithListContainer"> <!-- Wrapper for list and potential messages -->
                <ul id="currentlySharedWithList" class="currently-shared-list">
                    <!-- JS will populate this:
                        <li>
                            <span>Username</span>
                            <select class="share-permission-select-existing" data-shared-user-id="USER_ID">
                                <option value="read">Read</option>
                                <option value="edit">Edit</option>
                            </select>
                            <button class="revoke-share-btn button">Revoke</button>
                        </li>
                    -->
                </ul>
                <p style="display:none; text-align: center; margin-top:10px;" id="noSharedUsersMsg">Not shared with anyone yet.</p>
            </div>
        </div>
    </div>

    <div class="note-editor-panel">
        <div class="panel-header">
            <input type="text" id="noteTitleInput" placeholder="Note Title" value="Grocery List">
            <select id="noteFolderSelect" class="note-folder-select">
                <option value="">Uncategorized</option>
                <!-- Folders will be populated here by JS -->
            </select>
            <div class="note-actions">
                <button id="saveNoteBtn" title="Save Note">Save</button>
                <button id="deleteNoteBtn" title="Delete Note">Delete</button>
                <button id="shareNoteBtn" title="Share Note">Share</button>
                <button id="qrCodeNoteBtn" title="Get QR Code for Note Link">&#9776;</button> <!-- Using a generic icon, like a menu or bars -->
                <button id="downloadNoteBtn" title="Download Note">&#11015;</button>
            </div>
        </div>
                <div class="toolbar" id="noteEditorToolbar">
            <!-- Formatting buttons: Bold, Italic, List, etc. -->
                    <button id="formatBoldBtn" title="Bold (Ctrl+B)">B</button>
                    <button id="formatItalicBtn" title="Italic (Ctrl+I)">I</button>
                    <button id="formatUnderlineBtn" title="Underline (Ctrl+U)">U</button>
                    <!-- Add more buttons for lists, etc. later if needed -->
        </div>
        <textarea id="noteContentTextarea" placeholder="Start writing your note here...">Milk, Eggs, Bread, Cheese, Apples.</textarea>
        <div class="note-editor-footer">
            <div class="tags-input-container">
                <label for="noteTagsInput">Tags:</label>
                <div class="autocomplete-wrapper"> <!-- Wrapper for input and suggestions -->
                    <input type="text" id="noteTagsInput" placeholder="Add tags, comma separated..." autocomplete="off">
                    <ul id="tagSuggestions" class="tag-suggestions-list" style="display: none;"></ul>
                </div>
                <div id="currentNoteTagsDisplay" class="tags-display-area">
                    <!-- Tags will be displayed here as pills -->
                </div>
            </div>
            <div class="note-metadata">
                 <span id="noteLastUpdated">Last updated: Oct 25, 2023</span>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qrCodeModal" class="modal" style="display:none;">
        <div class="modal-content text-center"> <!-- Added text-center for modal content -->
            <span class="close-button" data-modal-id="qrCodeModal">&times;</span>
            <h4>Share Note Link via QR Code</h4>
            <div id="qrCodeCanvasContainer" style="margin: 20px auto; width: 200px; height: 200px;">
                <!-- QR code will be rendered here by JS (e.g., as a canvas or img) -->
            </div>
            <p>Scan the QR code above or use the link below:</p>
            <input type="text" id="qrCodeUrlDisplay" readonly style="width: 90%; margin-bottom: 10px; text-align: center;">
            <button id="copyQrCodeUrlBtn" class="button">Copy Link</button>
        </div>
    </div>

    <!-- QR Code Library (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <!-- 2FA Setup Modal -->
    <div id="twoFaSetupModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-button" data-modal-id="twoFaSetupModal">&times;</span>
            <h4>Two-Factor Authentication (2FA)</h4>

            <div id="2faInitialActions">
                <p>Status: <strong id="2faStatusText">Disabled</strong></p>
                <button id="enable2faInitBtn" class="button-primary">Enable 2FA</button>
                <button id="disable2faBtn" class="button" style="display:none;">Disable 2FA</button>
            </div>

            <div id="2faQrCodeSection" style="display:none; margin-top:15px; text-align:center;">
                <p>1. Scan this QR code with your authenticator app (e.g., Google Authenticator, Authy):</p>
                <div id="2faQrCodeDisplay" style="width: 200px; height: 200px; margin: 10px auto; border:1px solid #ccc;"></div>
                <p>Or, manually enter this secret key:</p>
                <strong id="2faSecretKeyDisplay" style="font-family: monospace; font-size: 1.1em; display:block; margin-bottom:15px;"></strong>
                <hr>
                <p>2. Enter the 6-digit code from your app to verify and enable 2FA:</p>
                <form id="verify2faForm">
                    <div class="form-group">
                        <label for="otpCodeInput">OTP Code:</label>
                        <input type="text" id="otpCodeInput" name="otp_code" required pattern="[0-9]{6}" maxlength="6" inputmode="numeric" style="text-align:center; font-size: 1.2em; letter-spacing: 2px;">
                    </div>
                    <button type="submit" class="button-primary">Verify & Enable 2FA</button>
                    <button type="button" id="cancel2faSetupBtn" class="button">Cancel</button>
                </form>
            </div>

            <div id="2faRecoveryCodesSection" style="display:none; margin-top:15px;">
                <h5>Save Your Recovery Codes!</h5>
                <p>Store these codes in a safe place. They can be used to access your account if you lose your authenticator device. Each code can only be used once.</p>
                <ul id="2faRecoveryCodesList" style="font-family: monospace; list-style-type: none; padding-left: 0;"></ul>
                <button id="finish2faSetupBtn" class="button-primary">Done, I've Saved Them</button>
            </div>
        </div>
    </div>

    <!-- Basic JS for interactivity, actual data will come from php/dashboard.php -->
    <script src="../js/dashboard.js"></script>
</body>
</html>
